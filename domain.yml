session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true

version: "3.1"

intents:
- welcome_greet
- init_request
- init_request_without_entity
- init_pizza_question
- item_price
- pizza_question_toppings
- inform
- cancel_order
#- item_start_generic
#- order_confirm_negative
#- order_confirm_positive
- item_change
#- extra_order_negative
#- extra_order_postive
- order_take_away
#- order_delivery_address
- order_delivery
#- order_confirm_final
# - item_confirm_no
# - item_confirm_yes
- response_negative
- response_positive
# - response_name_phone
# - item_change_request_without_entity
# - item_type_start_negative
# - item_type_start_postive
# - item_type
# - item_size
# - item_topping
# - item_amount
- pizza_availability
# - item_type_start_positive
- out_of_scope
#- new_client
#- old_client
- provide_name
- provide_phone_number
- provide_address_street
- provide_address_number
- provide_address_city
- pay_cash
- pay_credit_card
#- provide_credit_card_number

entities:
- pizza_size
- pizza_type
- pizza_amount
- toppings
- client_name
- phone_number
- address_street
- address_number
- address_city
- credit-card-number

slots:
  client_name:
    type: any
    mappings:
      - type: from_entity
        entity: client_name
        conditions:
        - active_loop: client_form
          requested_slot: client_name
  phone_number:
    type: any
    mappings:
      - type: from_entity
        entity: phone_number
        conditions:
        - active_loop: client_form
          requested_slot: phone_number
  address_street:
    type: any
    mappings:
      - type: from_entity
        entity: address_street
        conditions:
        - active_loop: delivery_form
          requested_slot: address_street
  address_number:
    type: any
    mappings:
      - type: from_entity
        entity: address_number
        conditions:
        - active_loop: delivery_form
          requested_slot: address_number
  address_city:
    type: any
    mappings:
      - type: from_entity
        entity: address_city
        conditions:
        - active_loop: delivery_form
          requested_slot: address_city
  pizza_amount:
    type: any
    mappings:
      - type: from_entity
        entity: pizza_amount
  pizza_size:
    type: any
    mappings:
      - type: from_entity
        entity: pizza_size
  pizza_type:
    type: any
    mappings:
      - type: from_entity
        entity: pizza_type
  new_client:
    type: bool
    influence_conversation: true
    mappings:
    - type: custom
  # requested_slot:
  #   type: any
  #   mappings:
  #     - type: custom
  toppings:
    type: any
    mappings:
      - type: from_entity
        entity: toppings
  credit-card-number:
    type: any
    mappings:
      - type: from_entity
        entity: credit-card-number

responses:
  utter_out_of_scope:
   - text: Sorry, I can't handle that request.
  utter_welcome_greet:
  - text: Hello There! Welcome to Tarantellabot.
  utter_init_pizza_question/size:
  - text: The available sizes are small, medium and large.
  utter_init_pizza_question/toppings:
  - text: The available toppings are cheese, mushrooms, sausages and potatoes.
  utter_ask_pizza_size:
  - text: And, what size would you like your {pizza_type} pizza to be?
  utter_ask_pizza_type:
  - text: What type of pizza do you want?
  utter_ask_pizza_amount:
  - text: Ok, how many {pizza_size} {pizza_type} pizzas do you want?
  utter_submit_form_pizza:
  - text: All done!
  utter_slots_values:
  - text: "Your order includes {pizza_amount} {pizza_size} {pizza_type} pizzas. Is that correct?"
  utter_anything_else:
  - text: "Great, your order is being processed! Anything else?"
  utter_order_confirm_negative:
  - text: What would you like to change?
  utter_order_delete:
  - text: Ok, are you sure you want to delete your order?
  utter_ask_client_name:
  - text: Can you tell me your name please?
  utter_ask_phone_number:
  - text: Can you tell me your phone number please?
  utter_check_address:
  - text: "Ok {client_name}, the delivery address of the last order was: {address_street} number {address_number}, {address_city}. Is that correct?"
  utter_ask_address_street:
  - text: Ok {client_name}, now I need some information for the delivery. Can you tell me your street name?
  utter_ask_address_number:
  - text: And, can you tell me your address number?
  utter_ask_address_city:
  - text: And, can you tell me your city?
  utter_submit_form_old_client:
  - text: Welcome back {client_name}, what do you want to do?
  utter_suggested_pizza:
  - text: Do you want to order the usual {pizza}?
  utter_total_cost:
  - text: It will be {cost} euros. Do you want to pay cash on delivery or by credit card?
  utter_ask_credit-card-number:
  - text: What is your credit card's number?
  utter_modality:
  - text: Do you prefer take away or home delivery?
  # utter_order_confirm_positive:
  # - text: Great. Anything else?
  # utter_item_change:
  # - text: Ok! So you want {pizza_amount} {pizza_type} pizzas in {pizza_size}. Is that
  #     correct?
  # utter_extra_order:
  # - text: Would you like to order anything else?
  # utter_final_order:
  # - text: Your total order is {pizza_amount} {pizza_type} pizzas in {pizza_size}.
  #     Do you prefer take away or home delivery?
  # utter_total_order_final:
  # - text: Do you prefer takeaway or home delivery
  # utter_name_phone:
  # - text: Here is your total order, {total_order} . what is your name and phone number?
  # utter_order_complete:
  # - text: Here is your order number {order_number}. Your order will be ready in 15
  #     minutes. Thanks for the opportunity to serve you
  # utter_delivery_address:
  # - text: Please provide us with your home/ office address
  # utter_order_add:
  # - text: which pizza like to add in your order?
  # utter_default:
  # - text: Sorry, I didn’t understand that. Can you please retype it?
  # utter_item_type_start_negative:
  # - text: sadly , we don't offer {pizza_type}
  # utter_item_type_start_postive:
  # - text: yes, we do offer {pizza_type} would you like to order one?
  # utter_item_type:
  # - text: what pizza type would you like?
  # utter_item_size:
  # - text: what size do you want your {pizza_type} in
  # utter_item_amount:
  # - text: how many would like?
  # utter_pizza_questions:
  # - text: what would you like on your pizza?
  # utter_order_processing_positive:
  # - text: Great. Your order is being processed. Please wait. We will get back to your
  #     shortly?
  # utter_order_processing_negative:
  # - text: Sorry, there is a problem with your order

  # utter_summarize_order:
  # - text: "Okay Great. Your order is {} {} pizzas in {}. Can you confirm please"
actions:
- utter_welcome_greet
- action_menu
#- utter_init_request
- utter_init_pizza_question/size
- utter_init_pizza_question/toppings
- action_price
- action_pizza_availability
- action_pizza_question_toppings
- action_response_positive
- utter_anything_else
- utter_out_of_scope
- action_response_negative
- utter_ask_pizza_size
- utter_ask_pizza_type
- utter_ask_pizza_amount
- utter_order_confirm_negative
- utter_order_delete
- utter_ask_client_name
- utter_ask_phone_number
- utter_ask_address_street
- utter_ask_address_number
- utter_ask_address_city
- check_client_name
- validate_client_form
- action_save_client
- action_suggest_pizza
- utter_suggested_pizza
- utter_ask_credit-card-number
- utter_modality
- utter_check_address
- action_check_address
# - utter_order_confirm_positive
# - utter_item_change
# - utter_extra_order
# - utter_final_order
# - utter_total_order_final
# - utter_name_phone
# - utter_order_complete
# - utter_delivery_address
# - action_change_order
# - action_pizza_order_add
# - action_reset_pizza_form
# - action_order_number
# - utter_item_type_start_negative
# - utter_item_type_start_postive
# - utter_item_type
# - utter_item_size
# - utter_item_amount
# - utter_pizza_questions
# - utter_order_processing_positive
# - utter_order_processing_negative
# - utter_order_add
# - utter_default
# - utter_summarize_order

forms:
  pizza_order_form:
    required_slots:
    - pizza_type
    - pizza_size
    - pizza_amount
  client_form:
    required_slots:
    - client_name
    - phone_number
  delivery_form:
    required_slots:
    - address_street
    - address_number
    - address_city
  credit_card_form:
    required_slots:
    - credit-card-number


# validare credit-card-number (duckling lo prende solo se è valido, ma se non è valido il form non viene riattivato). Non si può validare perchè non si può usare - nei nomi delle funzioni